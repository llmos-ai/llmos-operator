# Optimized webhook container with Chainguard Wolfi base image
FROM cgr.dev/chainguard/wolfi-base

# Install basic tools
RUN apk add --no-cache bash tini curl kubectl jq

WORKDIR /var/lib/llmos/llmos-operator

# Copy binary and unified entrypoint
COPY llmos-operator /usr/bin/llmos-operator
COPY package/entrypoint.sh /usr/bin/entrypoint.sh

# Set build metadata
ARG VERSION
ARG DATE
ENV LLMOS_SERVER_VERSION=${VERSION}
ENV LLMOS_BUILD_DATE=${DATE}

VOLUME /var/lib/llmos/llmos-operator
ENV LLMOS_MODE=webhook
ENTRYPOINT ["/usr/bin/entrypoint.sh"]
